import logging
from pathlib import Path

import pandas as pd
import numpy as np

from .dataset import DataField, StrField, Field
from .json import JSONDataSetContainer
from .instanced import InstanceCheriBSD, InstancePlatform


class PidMapDataset(JSONDataSetContainer):
    """
    JSON output generated by the --libxo option of the ps command
    Currently we only support a subset of the output values
    """
    dataset_id = "pidmap"
    fields = [Field("pid", dtype=int), Field("uid", dtype=int), StrField("command")]

    def raw_fields(self, include_derived=False):
        return PidMapDataset.fields

    def load(self, path: Path):
        df = self._load_json(path, orient="records")
        self._internalize_json(df)
